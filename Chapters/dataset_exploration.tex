\section{Exploration}
\label{sec:exploration}

While collecting these data, it was helpful to explore them, in order to
discover features that could characterize places and help cluster them into
similar groups.

\subsection{Time}

The time at which check-ins occur is undoubtedly a important variable. For
instance, \textcite{UrbanStory12} perform topic modelling from the text of
check-in tweets and show that various topics exhibit daily or weekly
patterns. Likewise, \textcite{TimeCluster13} cluster cells of a rectangular
grid according to their repartition of check-ins over categories and time of
day.

Thus we first look at when check-ins are performed through the day
\autoref{fig:daily_checkin} or the week \autoref{fig:weekly_checkin}, and how it
differs whether we consider New York, the city that never sleeps, or Helsinki.

But these patterns do not affect all venues uniformly. Taking Paris as an
example, we can summarize each venue's activity by an histogram with 3 or 4
four hours bins. Then, running $k$-means algorithm with $k=5$, we obtained the
clusters depicted in \autoref{fig:day_cluster}. We observe that they have the
same characteristic shape with one peak during the day and relatively low
activity the rest of the time. We repeat these in all the cities to determine
if these clusters are universal. As showed in \autoref{fig:time_cluster_size}
\vpageref{fig:time_cluster_size}, it is the case with 4-hours bins, but
3-hours clusters exhibit slight variations across the cities of our dataset.

\begin{figure}[hbt]
    \begin{subfigure}[b]{\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{%
        \includegraphics[width=\textwidth]{daily_checkin}
    }{%
        \input{mkfigs/daily_checkin}
    }
	\caption[Pattern of check-in during the day]{Hourly check-ins frequency
		during the day. The activity is at its lowest around 5 \am\ and after
		that, there are three peaks: one when people go to work in the morning,
		one in the middle of the day and the last one at the end of the
		evening. Yet, depending of the city, these peaks do not happen at the
		same time, nor with the same intensity. Therefore, instead of working
		directly the raw values of features, we use the number of standard
		deviation or \emph{z-score}.\label{fig:daily_checkin}}
    \end{subfigure}

    \begin{subfigure}[b]{\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{%
        \includegraphics[width=\textwidth]{weekly_checkin}
    }{%
        \input{mkfigs/weekly_checkin}
    }
	\caption[Pattern of check-in during the week]{Four-hour check-in frequency
	during the week. We observe a day/night cycle, which becomes less
	distinctive as the weekend is approaching and disappears on
	Saturday.\label{fig:weekly_checkin}}
    \end{subfigure}
    \caption{Check-ins temporal pattern.\label{fig:time_checkin}}
\end{figure}

\begin{figure}[hbt]
    \begin{subfigure}[b]{\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[width=\textwidth]{day_cluster_3h}}{\input{mkfigs/day_cluster_3h}}
    \end{subfigure}

    \begin{subfigure}[b]{\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[width=\textwidth]{day_cluster_4h}}{\input{mkfigs/day_cluster_4h}}
    \end{subfigure}
    \caption[Venues clustered by time of check-ins]{Venues clustered by time
    of check-ins. \label{fig:day_cluster}}
\end{figure}

\newgeometry{vmargin=0.65cm,hmargin=1.4cm}
\begin{figure}[p]
	\centering
    \begin{subfigure}[b]{0.35\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_3h_cl1}}{\input{mkfigs/cluster_day_3h_cl1}}
    \end{subfigure}~
    \begin{subfigure}[b]{0.35\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_4h_cl1}}{\input{mkfigs/cluster_day_4h_cl1}}
    \end{subfigure}

    \begin{subfigure}[b]{0.35\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_3h_cl2}}{\input{mkfigs/cluster_day_3h_cl2}}
    \end{subfigure}~
    \begin{subfigure}[b]{0.35\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_4h_cl2}}{\input{mkfigs/cluster_day_4h_cl2}}
    \end{subfigure}

    \begin{subfigure}[b]{0.35\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_3h_cl3}}{\input{mkfigs/cluster_day_3h_cl3}}
    \end{subfigure}~
    \begin{subfigure}[b]{0.35\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_4h_cl3}}{\input{mkfigs/cluster_day_4h_cl3}}
    \end{subfigure}

    \begin{subfigure}[b]{0.35\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_3h_cl4}}{\input{mkfigs/cluster_day_3h_cl4}}
    \end{subfigure}~
    \begin{subfigure}[b]{0.35\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_4h_cl4}}{\input{mkfigs/cluster_day_4h_cl4}}
    \end{subfigure}

    \begin{subfigure}[b]{0.35\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_3h_cl5}}{\input{mkfigs/cluster_day_3h_cl5}}
    \end{subfigure}~
    \begin{subfigure}[b]{0.35\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_4h_cl5}}{\input{mkfigs/cluster_day_4h_cl5}}
    \end{subfigure}
    \caption[Venues cluster by time among all the cities]{
		Results of $k$-means with $k=5$ on the 3-hours window (left column) and 4-hours window (right column) check-in distribution of venues. 
Each line in each figure is the centroid of a cluster in a city.\label{fig:time_cluster_size}}
\end{figure}
\clearpage
\restoregeometry

\subsection{Space}

The other main characteristic of every check-in is where it takes place. We
focus on two spatial feature of venues. First, was does the surrounding looks
like in terms of categories. For instance, if a restaurant is mainly
surrounded by night life places and another by education buildings, they
probably have different customers. Second, venues are not uniformly
distributed within the city and the density of nearby locations is a
discriminative feature as well. For instance in \autoref{fig:density_paris}
\vpageref{fig:density_paris}, we can clearly distinguish venues belonging to
the city center from the others.

\begin{figure}[h]
        \centering
    \begin{subfigure}[b]{0.25\textheight}
        \centering
        \includegraphics[width=\textwidth]{paris_new_density_50.pdf}
    \end{subfigure}~
    \begin{subfigure}[b]{0.25\textheight}
	\includegraphics[width=\textwidth]{paris_new_density_350.pdf}
    \end{subfigure}
    \begin{subfigure}[b]{0.25\textheight}
        \centering
	\includegraphics[width=\textwidth]{paris_new_density_160.pdf}
    \end{subfigure}
\caption[Venue density in Paris]{Estimated density of 3192 venues in Paris by
	a Gaussian kernel, cropped to the center of the city. On the left, the
	bandwidth is 50 meters and it looks too small: venues are isolated. In
	the middle, $h=160$ because this value maximize the probability of
	existing venues. On the right, $h=350$ corresponds to human
definition of neighborhood size.\label{fig:density_paris}}
\end{figure}

\subsection{Location entropy}

\Textcite{Entropy10} showed that \enquote{location entropy, which measures the
diversity of unique visitors of a location} gives good indication of the
sociability level of venues and therefore help predicting friendship ties within
\gls{lbsn}.

Let $\mathcal{U}$ be the set of users and $\mathcal{V}$ the one of venues. For
each venue $v \in \mathcal{V}$, we can gather the set of check-ins $c_v$ that
occurred there as well as the corresponding users $[u_1, u_2, u_2, \ldots,
u_n]$ (note that the same users can check-in multiple times). Then we
transform this list to a frequency distribution $f_v$ over $\mathcal{U}$ and
compute the normalized entropy: \[
    H(v) = -\frac{1}{\log\left(\left| \mathcal{U}\right|\right)}
\sum_{u\in \mathcal{U}} f_v(u) \log(f_v(u)) \]

Computing this value for all venues in Paris and Barcelona shows that it is a
good descriptor of the \enquote{publicness} of a place. As showed in
\autoref{tab:entropy}, touristic attractions like the Sagrada Família or the
Eiffel Tower exhibit high entropy because they are visited by a large and
diverse set of people. On the other hand, work offices and private houses have
low entropy, as they attract a much more restricted crowd.

\begin{figure}[p]
\begin{subfigure}{0.45\textheight}\centering
% \begin{table}
	% \centering
\begin{tabular}{lllr}
	\toprule
	City                       & Name                            & Category                 & Entropy \\
	\midrule
	\multirow{3}{*}{Barcelona} & Castellers de Barcelona         & Non-Profit               & $0.0139$ \\
	                           & Café de la Pompeu               & Café                     & $0.0172$ \\
	                           & Ràdio 4                         & Radio Station            & $0.0176$ \\
	%                          & La Comarca                      & Home (private)           & $0.0180$ \\
	%                          & House castellar                 & Home (private)           & $0.0181$ \\
	%                          & Av Tomas Gimenez                & Bar                      & $0.0186$ \\
	%                          & Torre De Barad-Dur              & Building                 & $0.0192$ \\
	\midrule
	\multirow{3}{*}{Paris}     & Boutique Orange                 & Electronics Store        & $0.0099$ \\
	                           & Métro Goncourt [11]             & Subway                   & $0.0105$ \\
	                           & Blue Acacia                     & Office                   & $0.0112$ \\
	%                          & Regus                           & Office                   & $0.0154$ \\
	%                          & Le Pareloup                     & French Restaurant        & $0.0177$ \\
	%                          & 10e arrondissement – Entrepôt   & States \& Municipalities & $0.0178$ \\
	\midrule
	%                          & Parc de la Ciutadella           & Park                     & $0.5188$ \\
	%                          & Apple Store                     & Electronics Store        & $0.5358$ \\
	%                          & Parc Güell                      & Park                     & $0.5666$ \\
	\multirow{4}{*}{Barcelona} & Plaça de Catalunya              & Plaza                    & $0.5835$ \\
	                           & Sants Estació                   & Train Station            & $0.6298$ \\
	                           & Sagrada Família                 & Government Building      & $0.6309$ \\
	                           & Camp Nou                        & Stadium                  & $0.6852$ \\
	\midrule
	%                          & Arc de Triomphe                 & Government Building      & $0.6234$ \\
	%                          & Cathédrale Notre-Dame de Paris  & Spiritual Center         & $0.6295$ \\
	%                          & Gare SNCF de Paris Montparnasse & Train Station            & $0.6337$ \\
	%                          & Avenue des Champs-Élysées       & Street                   & $0.6450$ \\
	\multirow{4}{*}{Paris}     & Gare SNCF : Gare de Lyon        & Train Station            & $0.6725$ \\
	                           & Gare SNCF : Paris Nord          & Train Station            & $0.6911$ \\
	                           & Musée du Louvre                 & Museum                   & $0.6924$ \\
	                           & Tour Eiffel                     & Government Building      & $0.7167$ \\
	\bottomrule
\end{tabular}
\caption{Venues in Paris and Barcelona with lowest and highest user
entropy.\label{tab:entropy}}
% \end{table}
\end{subfigure}

\begin{subfigure}{0.45\textheight} \centering
% \begin{figure}[hb]
% 	\centering
	\includegraphics[height=.4\textheight]{two_entropies.pdf}
	\caption{Venues entropy in Paris with respect to user population and time of check-in
	during the day. \label{fig:two_entropies}}
\end{subfigure}
\end{figure}

Following the same idea, we also computed the entropy of locations with respect
to time of check-ins. Indeed, it distinguishes between a railway station active
all day long and a restaurant open only during lunch hours.  We also expect a
link between the two entropies, as places that stay open longer have more
chance to be visited by a various set of users. But this relation, shown on
\autoref{fig:two_entropies} \vpageref{fig:two_entropies} is weak, as some places are visited all the time by
a small group of dedicated people.



\subsection{Photos}

Finally, one interesting aspect of this dataset is the interaction between
check-ins and photos.  The spatial repartition of both objects can be seen as
an indirect signal of interest within the city. Thus we were curious to see in
which place they disagree, that is location where there is significantly more
photos taken that what we would expect by looking at the tweet concentration
(and conversely). To answer this question, we compute the discrepancy between
this two measure of activity \autocite{Agarwal2006spatial}. It turns out that
some places are mostly checked-in because events take place there (such as when
people arrive in a new city via a railway station or an airport, or when a
sport team plays a match in a stadium) whereas other are more photographed,
like museum or touristic sights.


% Look at high and low focus places: not so interesting either. High value are
% for popular places like park or monument whereas low (but not zero) are for
% mundane place (like pizzeria) close to famous locations.
\clearpage
