\section{Exploration}

While collecting these data, it was helpful to explore them, in order to
discover features that could characterize places and help cluster them into
similar groups.

\subsection{Time}

The time at which check-ins occur is undoubtedly a important variable. For
instance, \textcite{UrbanStory12} performed topic modelling from the text of
check-in tweets and showed that various topics exhibit daily or weekly
patterns. Likewise, \textcite{TimeCluster13} clustered cells of a rectangular
grid according to their repartition of check-ins over categories and time of
day.

Thus we first looked at when check-ins are performed, and how it differed from
city to city \autoref{fig:time_checkin}. Then we adopted a venue-centric view
and clustered locations according to which time they are active
\autoref{fig:day_cluster}, which also depend of the city
\autoref{fig:time_cluster_size}.

\begin{figure}[hbt]
    \begin{subfigure}[b]{\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{%
        \includegraphics[width=\textwidth]{daily_checkin}
    }{%
        \input{mkfigs/daily_checkin}
    }
    \caption[Pattern of check-in during the day]{Generally, the activity is at
    its lowest around 5 \am{}\ and during the day, there are three peaks: one
when people go to work in the morning, one in the middle of the day and the
last one at the end of the evening. Yet, depending of the city, these peaks do
not happen at the same time, nor with the same intensity.
\label{fig:daily_checkin}}
    \end{subfigure}

    \begin{subfigure}[b]{\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{%
        \includegraphics[width=\textwidth]{weekly_checkin}
    }{%
        \input{mkfigs/weekly_checkin}
    }
    \caption[Pattern of check-in during the week]{During the week, patterns
        are less clear.  \label{fig:weekly_checkin}}
    \end{subfigure}
    \caption{Check-ins temporal pattern.\label{fig:time_checkin}}
\end{figure}

\begin{figure}[hbt]
    \begin{subfigure}[b]{\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[width=\textwidth]{day_cluster_3h}}{\input{mkfigs/day_cluster_3h}}
    \end{subfigure}

    \begin{subfigure}[b]{\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[width=\textwidth]{day_cluster_4h}}{\input{mkfigs/day_cluster_4h}}
    \end{subfigure}
    \caption[Venues clustered by time of check-ins]{Venues clustered by time
    of check-ins. \label{fig:day_cluster}}
\end{figure}

\newgeometry{left=0.3cm,right=0.3cm,bottom=0.1cm,top=0.1cm}
\begin{center}
\begin{figure}[hbt]
    \begin{subfigure}[b]{0.4\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_3h_cl1}}{\input{mkfigs/cluster_day_3h_cl1}}
    \end{subfigure}~
    \begin{subfigure}[b]{0.4\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_4h_cl1}}{\input{mkfigs/cluster_day_4h_cl1}}
    \end{subfigure}

    \begin{subfigure}[b]{0.4\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_3h_cl2}}{\input{mkfigs/cluster_day_3h_cl2}}
    \end{subfigure}~
    \begin{subfigure}[b]{0.4\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_4h_cl2}}{\input{mkfigs/cluster_day_4h_cl2}}
    \end{subfigure}

    \begin{subfigure}[b]{0.4\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_3h_cl3}}{\input{mkfigs/cluster_day_3h_cl3}}
    \end{subfigure}~
    \begin{subfigure}[b]{0.4\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_4h_cl3}}{\input{mkfigs/cluster_day_4h_cl3}}
    \end{subfigure}

    \begin{subfigure}[b]{0.4\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_3h_cl4}}{\input{mkfigs/cluster_day_3h_cl4}}
    \end{subfigure}~
    \begin{subfigure}[b]{0.4\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_4h_cl4}}{\input{mkfigs/cluster_day_4h_cl4}}
    \end{subfigure}

    \begin{subfigure}[b]{0.4\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_3h_cl5}}{\input{mkfigs/cluster_day_3h_cl5}}
    \end{subfigure}~
    \begin{subfigure}[b]{0.4\textwidth}
    \centering
    \iftoggle{EXTERNALPGF}{\includegraphics[height=0.18\textheight]{cluster_day_4h_cl5}}{\input{mkfigs/cluster_day_4h_cl5}}
    \end{subfigure}
    \caption[Venues cluster by time among all the cities]{4 hours time
    clusters are the same among all cities, whereas it is not the case for 3
hours clusters. \label{fig:time_cluster_size}}
\end{figure}
\end{center}
\restoregeometry

\subsection{Space}

The other main characteristic of every check-in is where it takes place. We
focus on two spatial feature of venues. First, was does the surrounding looks
like in terms of categories. For instance, if a restaurant is mainly
surrounded by night life places and another by education buildings, they
probably have different customers. Second, venues are not uniformly
distributed within the city and the density of nearby locations is a
discriminative feature as well. For instance in \autoref{fig:density_paris},
we can clearly distinguish venues belonging to the city center from the
others.

\begin{figure}[hbtp]
\includegraphics[width=\textwidth]{density_paris_venues}
\caption[Venue density in Paris]{Estimated venues density in Paris by a
	Gaussian kernel.\label{fig:density_paris}}
\end{figure}

\subsection{Location entropy}

\Textcite{Entropy10} showed that \enquote{location entropy, which measures the
diversity of unique visitors of a location} gives good indication of the
sociability level of venues and therefore help predicting friendship ties within
\gls{lbsn}.

Let $\mathcal{U}$ be the set of users and $\mathcal{V}$ the one of venues. For
each venue $v \in \mathcal{V}$, we can gather the set of check-ins $c_v$ that
occurred there as well as the corresponding users $[u_1, u_2, u_2, \ldots,
u_n]$ (note that the same users can check-in multiple times). Then we
transform this list to a frequency distribution $f_v$ over $\mathcal{U}$ and
compute the normalized entropy: \[
    H(v) = -\frac{1}{\log\left(\left| \mathcal{U}\right|\right)}
\sum_{u\in \mathcal{U}} f_v(u) \log(f_v(u)) \]

Show examples with high and low value in Paris and Barcelona:

\begin{tabular}{llr}
	\toprule
	Name                    & Category            & Entropy \\
	\midrule
    Castellers de Barcelona       & Non-Profit        & 0.0139 \\
    Café de la Pompeu             & Café              & 0.0172 \\
    Ràdio 4                       & Radio Station     & 0.0176 \\
    La Comarca                    & Home (private)    & 0.0180 \\
    House castellar               & Home (private)    & 0.0181 \\
    Av Tomas Gimenez              & Bar               & 0.0186 \\
    Torre De Barad-Dur            & Building          & 0.0192 \\
    \midrule
    Blue Acacia                   & Office            & 0.0119 \\
    Boutique Orange               & Electronics Store & 0.0141 \\
    Regus                         & Office            & 0.0163 \\
    Café Pierre                   & French Restaurant & 0.0181 \\
    my home 2                     & Home (private)    & 0.0193 \\
    10e arrondissement – Entrepôt & \& Municipalities & 0.0213 \\
    Scanblog                      & Office            & 0.0221 \\
	\midrule
    Parc de la Ciutadella          & Park                & 0.5188 \\
    Apple Store                    & Electronics Store   & 0.5358 \\
    Parc Güell                     & Park                & 0.5666 \\
    Plaça de Catalunya             & Plaza               & 0.5835 \\
    Sants Estació                  & Train Station       & 0.6298 \\
    Sagrada Família                & Government Building & 0.6309 \\
    Camp Nou                       & Stadium             & 0.6852 \\
    \midrule
    Arc de Triomphe                & Government Building & 0.5831 \\
    Cathédrale Notre-Dame de Paris & Spiritual Center    & 0.5874 \\
    Gare SNCF Paris Montparnasse   & Train Station       & 0.6141 \\
    Musée du Louvre                & Museum              & 0.6444 \\
    Gare SNCF Gare de Lyon         & Train Station       & 0.6460 \\
    Tour Eiffel                    & Government Building & 0.6618 \\
    Gare SNCF Paris Nord           & Train Station       & 0.6707 \\
	\bottomrule
\end{tabular}

Following the same idea, we also computed the entropy of locations with
respect to time of check-ins. Indeed, it distinguishes between a railway
station active all day along and a restaurant only open during lunch hours.
We are also expecting a link between the two entropies, as place that stay
open longer have more chance to be enjoy a various crowd. But it is not the
cases on \autoref{fig:two_entropies}, as some places are visited all the time
by a very small group of people

\begin{figure}[hbtp]
\includegraphics[width=\textwidth]{two_entropies}
\caption{Venues entropy with respect to user population and time of check-in
during the day. \label{fig:two_entropies}}
\end{figure}


\subsection{Photos}

Assume that photos are background signal of interest within city. Use exact
grid algo from \autocite{Agarwal2006spatial} to compute discrepancy with
check-ins measurement (and conversely). \marginpar{give real examples} More
photos in touristic places, more check-in in “event” places (railway, stadium)

Look at high and low focus places: not so interesting either. High value are
for popular places like park or monument whereas low (but not zero) are for
mundane place (like pizzeria) close to famous locations.

\section{Chosen representation}

Based on the insights gained by exploring the dataset, we settle to represents
each venues by the numerical vector presented in \autoref{tab:venuefeatures}.
The features involving the surrounding (numbered from 6 to 16 and 25 to 30)
were weighted by a 2D Gaussian of radius $r=350$ meters.

\begin{table}[hb]
    \centering
    \begin{tabularx}{\textwidth}{lX}
        \toprule
        index & description \\
        \midrule
	\datasetRow{}0 & Number of likes \\
	\datasetRow{}1 & Number of unique users \\
	\datasetRow{}2 & Number of total check-ins \\
        3 & User entropy \\
        4 & Venue density \\
	\datasetRow{}5 & Venue top level category \\
        6 & \enquote{Arts \& Entertainment} venues around \\
        7 & \enquote{College \& University} venues around \\
        8 & \enquote{Food} venues around \\
        9 & \enquote{Nightlife Spot} venues around \\
        10 & \enquote{Outdoors \& Recreation} venues around \\
        11 & \enquote{Shop \& Service} venues around \\
        12 & \enquote{Professional \& Other Places} venues around \\
        13 & \enquote{Residence} venues around \\
        14 & \enquote{Travel \& Transport} venues around \\
	15 & Ratio of photos over check-ins \\
	16 & Ratio of photos associated to the venue over photos linked to other venues \\
	17 & More than half of the check-ins occurs during the week-end \\
	18 & Frequency of check-ins between 2 \am{} and 6 \am{} \\
	19 & Frequency of check-ins between 6 \am{} and 10 \am{} \\
	20 & Frequency of check-ins between 10 \am{} and 2 \hpm{} \\
	21 & Frequency of check-ins between 2 \hpm{} and 6 \hpm{} \\
	22 & Frequency of check-ins between 6 \hpm{} and 10 \hpm{} \\
	23 & Frequency of check-ins between 10 \hpm{} and 2 \am{} \\
	24 & Time entropy \\
	25 & Frequency of neighbouring check-ins between 2 \am{} and 6 \am{} \\
	26 & Frequency of neighbouring check-ins between 6 \am{} and 10 \am{} \\
	27 & Frequency of neighbouring check-ins between 10 \am{} and 2 \hpm{} \\
	28 & Frequency of neighbouring check-ins between 2 \hpm{} and 6 \hpm{} \\
	29 & Frequency of neighbouring check-ins between 6 \hpm{} and 10 \hpm{} \\
	30 & Frequency of neighbouring check-ins between 10 \hpm{} and 2 \am{} \\
        \bottomrule
    \end{tabularx}
    \caption[Venue features]{Feature representation of Foursquare venues,
	    taking surrounding into account. \colorbox{Moccasin}{Shaded
	    features} are provided directly by Foursquare database whereas the
	    others were computed solely based on the partial information
	    contained in the dataset.\label{tab:venuefeatures}}
\end{table}
